# 検索結果の並べ替え

[検索結果](./search-results.md) ウィジェットに表示される検索結果は、デフォルトで [関連性スコア](./search-results.md#search-results-relevance) （ [検索エンジン](https://www.elastic.co/guide/en/elasticsearch/guide/master/scoring-theory.html)によって計算される）の順に並べられます。 並べ替えウィジェットを使用すると、ユーザーは返される結果の順序を制御できます。

ウィジェットを [検索ページ](../working-with-search-pages/search-pages.md) に追加して、結果のソートを開始します。

そのままの状態で、関連性ソートの代わりに次の方法で結果を並べ替えることができます。

  - タイトルのアルファベット順
  - 更新日（デフォルトでは最初に最新、または最も古いものを最初に選択）
  - 作成日（デフォルトでは最初に最新、または古いものを最初に選択）
  - 一致する各アセットを作成したユーザーのアルファベット順

並べ替えウィジェットの事前構成された並べ替え戦略のいずれかから選択するか、独自の戦略を構成します。

ウィジェットから不要な並べ替えオプションを削除することもできます。

## ページへの並べ替えウィジェットの追加

並べ替えウィジェットを使い始めるには、

1.  ページの[追加]メニュー（![Add](../../../images/icon-add-widget.png)）を開き、[ウィジェット]セクションを展開します。

2.  [検索]カテゴリから、並べ替えウィジェットをページにドラッグします。

## 並べ替えウィジェットの構成

並べ替えウィジェットの設定画面から、次のことができます

  - 既存の並べ替えオプションを編集する
  - オプションを削除する
  - 新しいオプションを追加する

![ユーザーは、並べ替えウィジェットを使用して検索結果を並べ替えることができます。](./sorting-search-results/images/01.png)

ウィジェット構成画面にアクセスするには、ウィジェットの[オプション]メニュー（![Options](../../../images/icon-app-options.png)）を開き、[ *構成*]をクリックします。

各並べ替えオプションには2つの設定があります： *ラベル* および *フィールド*。

**ラベル：** 構成するソートのタイプに表示されるラベルを設定します。

**フィールド：** ソートするインデックス付きフィールドの `fieldName` を入力します。 ほとんどの場合、これは [キーワード](https://www.elastic.co/guide/en/elasticsearch/reference/7.x/keyword.html) フィールドです。 その他の受け入れ可能なオプションは、 `日付` および任意の [数値データ型](https://www.elastic.co/guide/en/elasticsearch/reference/7.x/number.html)です。 並べ替えウィジェット（以下を参照）で `テキスト` フィールドを強制的に動作させる方法さえあります。

![並べ替えウィジェットの構成から、並べ替えオプションを追加、編集、または削除します。](./sorting-search-results/images/02.png)

## 並べ替え可能なフィールドの検索

並べ替えウィジェットで使用できるフィールドを見つけるために、適切な権限を持つユーザーは *コントロールパネル* → *構成* → *検索*移動できます。 そこから、[フィールドマッピング]タブを開き、各インデックスのマッピングを参照します。 マッピングの `プロパティ` セクションまでスクロールし、 `キーワード` フィールド、 `日付` フィールド、または数値データタイプのフィールドを見つけます。 `タイプ` フィールドは有益です：

    "type" : "keyword"
    
    "type" : "date"
    
    "type" : "long"

`テキスト` フィールドでソートする必要がある場合は、タイプ `キーワード`して、フィールドの新しいバージョンをインデックスに追加します。 上記のフィールドマッピング画面で、 `liferay-[companyID]`というインデックスの `firstName` フィールドを確認します。

    "firstName" : {
        "type" : "text",
        "store" : true
    },
    "firstName_sortable" : {
        "type" : "keyword",
        "store" : true
    },

サフィックス `_sortable`対応するフィールドがあり、ソートに適したタイプ（`キーワード`）があります。 ソート可能なフィールドは、 [ポータルプロパティ](https://docs.liferay.com/portal/7.3-latest/propertiesdoc/portal.properties.html#Lucene%20Search)介して取得されます。

``` properties
index.sortable.text.fields=firstName,jobTitle,lastName,name,screenName,title
```

ここにリストされているすべてのテキストフィールドには、インデックスで自動的に作成される `fieldName_sortable` 対応物があります。 さらに追加するには、このプロパティを [`portal-ext.properties`](./../../../installation-and-upgrades/reference/portal-properties.md) ファイルにLiferayホームフォルダーにコピーし、並べ替えに必要な新しいフィールド名を追加して、サーバーを再起動します。

## 新しい並べ替えオプションの追加

新しいフィールドまたは適切なタイプの既存のフィールドで並べ替えるには、既存のオプションの *フィールド* 構成の下にあるプラス記号を使用して、ウィジェット構成でフィールドの `fieldName_sortable` バージョンを必ず使用してください。

すでに適切なデータ型である新しい並べ替えオプションを追加するには、オプションの *フィールド* 構成の下にあるプラス記号を使用して、フィールドに入力します。 構成画面でのオプションの順序は、ウィジェットを検索用に構成するときの選択リストの順序と一致します。

## 並べ替えオプションの編集と削除

既存のオプションを編集するには、設定セクションのテキストを編集します。

既存のオプションを削除するには、 *フィールド* 設定の下にあるマイナス記号を使用します。

## ソート順の制御

並べ替えオプションの順序を制御するには、 `fieldName`後にプラス記号またはマイナス記号を追加します。 それがどのように機能するかを理解するために、 *作成* および *作成（最も古い）* とラベル付けされた既存のソートオプションの実行方法を見てください。

**ラベル：** *作成済み* **フィールド：** `createDate-`

フィールド名の次の`-` 記号は順序が*下降*であることを示します 。 この方法で並べ替えると、最近作成された検索結果がリストの一番上に表示されます。

**ラベル：** *作成（最も古いものから）* **フィールド：** `createDate +`

フィールド名に続く `+` 記号は、順序が *昇順*ことを示しています。 この方法で並べ替えると、最も古い（作成日順）結果がリストの一番上に表示されます。
